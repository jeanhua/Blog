---
title: èŠ±äº†4ä¸ªå°æ—¶ï¼Œå®ç°äº†åšå®¢è‡ªåŠ¨æ„å»ºè„šæœ¬(golang)
date: 2025-05-04 00:21:06
tags:
- golang
- github
- hmac256
- åšå®¢
- è‡ªåŠ¨åŒ–
categories:
- éšç¬”
---

## å‰è¨€

æœ€è¿‘æœåŠ¡å™¨å¿«åˆ°æœŸäº†ï¼Œå‡†å¤‡æ¢æ–°æœåŠ¡å™¨ï¼Œéšå³æ‰“ç®—æ•´ç†ä¸€ä¸‹èµ„æ–™å‡†å¤‡è½¬ç§»ï¼Œåˆ°åšå®¢è¿™é‡Œå‘ç°ï¼Œä¹‹å‰æ˜¯æ„å»ºåpushåˆ°githubï¼Œå†é€šçŸ¥åç«¯è¿›è¡Œgit pullï¼Œä½†æ˜¯å‘ç°æ¯æ¬¡pushçš„æˆå“æ›´æ”¹å¾ˆå¤šï¼Œå¯¼è‡´.gitæ–‡ä»¶å¾ˆå¤§ï¼ŒæŒ‰ç†è¯´gitä»“åº“åªåº”è¯¥å­˜å‚¨æºç ï¼Œäºæ˜¯å‡†å¤‡æ¢æˆåç«¯pullæºç è¿›è¡Œæ„å»ºï¼Œä½†æ˜¯é‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š

## nginxè½¯é“¾æ¥404é—®é¢˜

nginxçš„é¡µé¢æ ¹ç›®å½•æ˜¯ä¸€èˆ¬æ˜¯æ”¾åœ¨`/var/www/`ä¸‹çš„ï¼Œä½†æ˜¯æˆ‘çš„ä»£ç æ–‡ä»¶ä¸åº”è¯¥æ”¾è¿™é‡Œï¼Œäºæ˜¯æ‰“ç®—åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼ŒæŒ‡å‘`/home/jeanhua/Blog/public`ï¼Œåˆšå¥½æ„å»ºå®Œå°±å¯ä»¥ï¼Œä¸ç”¨å¤åˆ¶æ–‡ä»¶è¿‡å»ï¼Œä½†æ˜¯å‡ºç°äº†404çš„é—®é¢˜ï¼Œæ’æŸ¥äº†ä¸€ä¸‹å‘ç°æ˜¯æƒé™é—®é¢˜ï¼Œnginxçš„ç»„æ˜¯www-dataï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ç»™åšå®¢ç›®å½•å’Œå¯¹åº”çš„çˆ¶ç›®å½•ä½¿ç”¨`chmod +x æ–‡ä»¶å¤¹`å³å¯

## github webhook secreté—®é¢˜

æŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œçš„é‰´æƒä»£ç ï¼Œæˆ‘è‡ªå·±å®ç°äº†goç‰ˆæœ¬ï¼Œä½†æ˜¯å‘ç°æ ¡éªŒå¤±è´¥ï¼Œæ£€æŸ¥å¾ˆå¤šéƒ½æ²¡å‘ç°é—®é¢˜ï¼Œæ›´ç¦»è°±çš„æ˜¯ä½¿ç”¨githubé¡µé¢æ—¥å¿—çš„åŸæ ·æ•°æ®è¿›è¡ŒåŠ å¯†åä¹Ÿå¾—ä¸åˆ°ç›¸åº”çš„ç»“æœï¼Œæœ€åæŠ˜è…¾3ä¸ªå°æ—¶å‘ç°æ˜¯GitHubè¯·æ±‚çš„jsonæ˜¯æœ€å°åŒ–å¤„ç†è¿‡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠå¤šä½™çš„ç©ºæ ¼éƒ½å»æ‰äº†ï¼Œä½†æ˜¯æŠ½è±¡çš„æ˜¯**é¡µé¢æ—¥å¿—æ˜¾ç¤ºçš„jsonæ˜¯æ ¼å¼åŒ–çš„**ï¼ˆå¦‚å›¾ï¼‰ï¼Œæˆ‘ç›´æ¥å¤åˆ¶åŠ å¯†çš„ç»“æœæ˜¯é”™çš„ğŸ˜¡

![image](/image/webhook/1.png)

## vim è‡ªåŠ¨åœ¨ç»“å°¾åŠ æ¢è¡Œç¬¦é—®é¢˜

ä¸Šé¢çš„é—®é¢˜è§£å†³åï¼Œåœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼ŒåŠ å¯†ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šé¢çš„å°±æ˜¯å‡ºé—®é¢˜äº†ï¼Œæ‰¾äº†ä¸€å †åœ°æ–¹ï¼Œæ²¡å‘ç°é—®é¢˜ï¼Œæœ€åçµæœºä¸€åŠ¨ï¼ŒæŠŠå¯†é’¥æ‰“å°å‡ºæ¥ï¼Œå‘ç°å¤šäº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä½†æ˜¯ç”¨vimæ‰“å¼€çš„æ—¶å€™æ²¡å‘ç°ç»“å°¾æœ‰æ¢è¡Œç¬¦çš„ï¼Œæˆ‘å†™çš„æ—¶å€™ä¹Ÿæ¯åŠ æ¢è¡Œç¬¦ï¼Œä¸€æŸ¥èµ„æ–™ï¼Œå‘ç°æ˜¯vimè‡ªå·±åŠ çš„ğŸ˜ï¼Œäºæ˜¯å»æ‰ä¹‹åæˆåŠŸäº†

> æŒ‰ç†è¯´è¿™ä¸ªæ‰æ˜¯ä¸»è¦é—®é¢˜ï¼Œå› ä¸ºä¸ç®¡jsonæ˜¯å¦æœ€å°åŒ–ï¼Œæˆ‘çš„ä»£ç æ˜¯å¯¹request bodyè¿›è¡ŒåŠ å¯†çš„ï¼Œåº”è¯¥æ²¡å•¥é—®é¢˜ï¼Œåªæ˜¯å¤šäº†è¿™ä¸ªæ¢è¡Œç¬¦å¯¼è‡´åŠ å¯†ç»“æœä¸ä¸€è‡´ï¼Œè€Œä¸Šé¢çš„é—®é¢˜å¯¼è‡´æˆ‘æµ‹è¯•ä¸å‡ºæ¥é—®é¢˜åœ¨å“ª

è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œä¸€è¡Œä»£ç å®Œæˆ  `keyText = strings.ReplaceAll(keyText, "\n", "")`

ç›¸å…³èµ„æ–™ï¼š

[vimç§»é™¤è‡ªåŠ¨æ·»åŠ çš„æ¢è¡Œç¬¦_å–æ¶ˆviç¼–è¾‘å™¨è‡ªåŠ¨æ¢è¡Œ-CSDNåšå®¢](https://blog.csdn.net/Quincuntial/article/details/111374789)

## æœ€åæˆæœ

[jeanhua/github-webhook-go: goå®ç°github webhook](https://github.com/jeanhua/github-webhook-go)

## é™„ æˆ‘çš„action.sh

```bash
cd /home/jeanhua/my_blog/Blog/ &&
git fetch origin main &&
git reset --hard origin/main &&
npm run build
```

> æ³¨æ„æ¯è¡Œç»“å°¾åŠ ä¸€ä¸ª &&ï¼Œä¸ç„¶ä¼šå‡ºä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜

## é™„ nginxè½¬å‘æœåŠ¡

```nginx
server{
    location /hook {
        proxy_pass http://localhost:5599;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## åç»­

ä½¿ç”¨jokerhttpæ¡†æ¶ï¼Œæ·»åŠ é…ç½®æ§åˆ¶ï¼Œæ”¯æŒæ›´å¤šè‡ªå®šä¹‰é€‰æ‹©
